# AI-FRCES(AI-powered food recognition and cost estimation system) Project
# (AI搭載食材認識＆コスト判別システム)

## 概要

このプロジェクトは、先進的なAI技術を駆使し、家庭内での食品ロス問題に革新的なソリューションを提供することを目指しています。

**現在の実装では、画像認識による食品識別とコスト計算がローカル環境で動作します。将来的には、センサー・カメラとの連携、クラウドへのデータ送信、スマートフォンアプリとの連携などを実装予定です。

** 開発中のシステムは、ディープラーニングベースの画像認識技術と高精度なセンシング技術を組み合わせることで、廃棄される食品の量と種類を自動的に識別・記録します。

さらに、専用のスマートフォンアプリとの連携機能を実装することで、ユーザーがリアルタイムで食品ロス状況を把握・分析できるようにし、食品ロス削減に向けた意識改革と行動変容を促します。

このシステムは、単に食品ロスを「見える化」するだけでなく、ユーザーの生活パターンに合わせたパーソナライズされたアドバイスを提供することで、より効果的な食品ロス削減を実現します。


## 開発の動機と背景

世界的に深刻化する食糧問題の解決策として、食品ロスの削減は極めて重要な課題です。

国連食糧農業機関（FAO）の報告によると、世界の食糧生産量の約3分の1が廃棄されていると推定されており、これは経済的損失だけでなく、環境問題にも大きく影響しています。

特に日本では、年間約612万トン（2019年度推計）の食品ロスが発生しており、これは世界全体の食品ロス量の約1割に相当します。その中でも、家庭から排出される食品ロスは約284万トンと全体の約半分を占めており、大きな問題となっています。
しかしながら、多くの家庭では、実際にどれだけの食品を廃棄しているかを正確に把握できていないのが現状です。

また、食品ロス問題に関する既存のデータは、全国レベルの統計データや過去の調査結果に基づいていることが多く、個々の家庭の状況を反映したリアルタイムなデータは不足しています。
そのため、食品ロス問題を「自分ごと」として捉え、具体的な行動に移すことが難しいという課題があります。

さらに、食品ロス削減のための情報提供も、一般的な知識やTipsにとどまっていることが多く、個々の家庭のライフスタイルや食習慣に合わせた具体的なアドバイスは不足しています。


## 解決策

本プロジェクトでは、AI搭載食品・食材判別システムを開発することで、家庭における食品ロス問題の解決に貢献します。このシステムは、従来の食品ロス対策とは異なり、以下の3つのアプローチでユーザーの行動変容を促します。

1. **高精度なデータ収集と可視化:**  高精度なセンシング技術とAI画像認識技術を組み合わせることで、廃棄される食品の種類と量、そして金額をリアルタイムに計測・記録し、ユーザーが容易に自身の食品ロス状況を把握できるようにします。従来の記録方法のように、手動で入力する手間を省き、客観的なデータに基づいて食品ロスを「見える化」することで、問題意識の醸成を促します。

2. **パーソナライズされたアドバイスの提供:**  システムが収集したデータに基づいて、ユーザーの食品ロス傾向を分析し、個々のライフスタイルや食習慣に合わせた具体的なアドバイスを提供します。例えば、「今週は野菜の廃棄量が多い傾向にあります。冷蔵庫の整理方法を見直してみましょう」といった具体的なアドバイスや、レシピ提案などを通じて、ユーザーが実践しやすい形で食品ロス削減をサポートします。

3. **スマート家電との連携による自動化 (将来的な展望):**  将来的には、冷蔵庫や調理家電などのスマート家電と連携することで、食品の購入日から消費期限、在庫状況などを自動的に管理し、食品ロスを最小限に抑える仕組みを構築します。例えば、冷蔵庫内の食材の賞味期限が近づくと、システムが自動的にレシピを提案したり、消費期限切れが近い食材をリストアップして警告を表示するなどの機能を実装することで、ユーザーの負担を軽減しながら食品ロス削減を実現します。



## システムの仕組み

AI搭載食品・食材判別システムは、以下の4つのステップで動作します。

1. **センシングと画像認識:** ディスポーザー、またはゴミ箱などに設置されたセンサーが食品の重量を計測し、同時にカメラが廃棄される食品の画像を撮影します。この時、センサーとカメラはシステムと無線で接続され、データがリアルタイムで送信されます。

2. **AIによる食品分類と量推定:**  クラウド上に構築されたAIモデルが、撮影された画像を解析し、廃棄された食品の種類と量を推定します。AIモデルは、大量の食品画像データで学習されており、高い精度で食品を識別することができます。また、画像から食品の体積を推定するアルゴリズムも実装することで、より正確な廃棄量を算出します。

3. **金額換算とデータ蓄積:** 推定された食品の種類と量に基づき、システム内のデータベースに保存されている単価情報（`food_prices.csv`）を参照して、廃棄された食品の金額を算出します。算出された金額、廃棄量、食品の種類などのデータは、ユーザーIDと紐づけてデータベースに蓄積されます。

4. **スマートフォンアプリへのデータ送信と可視化:** 蓄積されたデータは、APIを通じてユーザーのスマートフォンアプリに送信されます。スマートフォンアプリでは、日別、週別、月別の食品ロス量や金額をグラフなどで分かりやすく表示し、ユーザーが自身の食品ロス状況を簡単に確認できるようにします。また、アプリ上でパーソナライズされた食品ロス削減アドバイスを提供することで、ユーザーの行動変容を支援します。



## 技術スタック

* **Python:** プログラミング言語。プロジェクト全体で使用されます。
* **PyTorch:** 深層学習フレームワーク。AIモデルの実行に使用します。(推奨)  TensorFlowも使用可能ですが、PyTorchの方がtimmとの相性が良いので推奨します。
* **Hugging Face Transformers:**  自然言語処理、画像処理などのTransformerモデルを提供するライブラリ。`DetrForObjectDetection`, `DetrImageProcessor` を使用します。
* **Pillow (PIL):** 画像処理ライブラリ。画像の読み込み、操作、保存などに使用します。
* **OpenCV (cv2):** 画像処理ライブラリ。`image_capture.py` でカメラからの画像取得に使用します。
* **Timm (PyTorch Image Models):**  PyTorch向け画像モデルライブラリ。`facebook/detr-resnet-50` モデルで使用される `ResNet` バックボーンの効率的な実装を提供します。
* **Requests:** HTTPライブラリ。`data_api.py` でHTTPリクエストの送受信に使用します。
* **NumPy:** 数値計算ライブラリ。多次元配列の処理などに使用します。
* **Pandas:** データ分析ライブラリ。`food_prices.csv` の読み込みやデータ操作に使用します。
* **Flask:** 軽量なWebフレームワーク。`data_api.py` でAPIを作成するために使用します。
* **SQLAlchemy:** Python SQLツールキットおよびオブジェクトリレーショナルマッパー (ORM)。`user_data.py` でデータベース操作に使用します。
* **SQLite:**  軽量なデータベース。ユーザーデータの保存に使用します。(他のデータベースも使用可能)


## AI-FRCES_Project ディレクトリ構造とファイル解説

```
AI-FRCES_Project/
├── database/              # データベース関連
│   ├── food_database.py   # 食品価格データベース操作
│   └── user_data.py       # ユーザーデータ管理
├── data_acquisition/      # データ取得関連
│   ├── sensor_reader.py   # センサーデータ取得
│   └── image_capture.py   # 画像撮影
├── image_processing/      # 画像処理関連
│   └── image_classifier.py # 画像分類 & 量推定
├── data_analysis/          # データ分析関連
│   └── cost_calculator.py # コスト計算
├── cloud_functions/      # クラウド関数
│   └── data_api.py        # データAPI
├── app/                   # スマートフォンアプリ関連
│   └── app.py            # アプリケーションロジック
├── food_prices.csv        # 食品の単価データ
├── main.py                # メインプログラム
├── requirements.txt       # 実行に必要なライブラリ
└── requirements-dev.txt   # 開発時に必要なライブラリ
```

### `database/`

* **`food_database.py`:** このファイルは、食品の価格情報を管理するためのモジュールです。`load_food_prices` 関数は、`food_prices.csv` ファイルから食品名と単価のデータを読み込み、辞書形式で返します。`get_unit_price` 関数は、指定された食品の単価を辞書から取得します。これらの関数は、`cost_calculator.py` で食品の廃棄コストを計算するために使用されます。CSVファイルの読み込みエラー処理や、食品名が存在しない場合の処理も実装することで、システムの安定性を向上させています。将来的には、CSVファイルではなくデータベースから価格情報を読み込むように変更することで、より大規模なデータにも対応できるようになります。

* **`user_data.py`:** このファイルは、ユーザーの食品ロスデータをデータベースに保存・取得するためのモジュールです。`create_table` 関数は、SQLiteデータベースに `food_waste_data` テーブルを作成します。`insert_data` 関数は、ユーザーID、食品の種類、重量、コスト、タイムスタンプをテーブルに挿入します。`get_data` 関数は、指定されたユーザーIDの食品ロスデータを取得します。これらの関数は、`main.py` や `cloud_functions/data_api.py` から呼び出されます。データベースとの接続管理、データの整合性チェック、エラー処理などを適切に実装することで、システムの信頼性を確保しています。将来的には、ユーザー認証やデータの暗号化などのセキュリティ対策も追加する必要があります。


### `data_acquisition/`

* **`sensor_reader.py`:** このファイルは、センサーから重量データを取得するためのモジュールです。現状では、シミュレーションとしてランダムな重量データを生成する `read_sensor_data` 関数が実装されています。将来的には、この関数を実際のセンサーハードウェアとのインターフェースに置き換える必要があります。具体的な実装は、使用するセンサーの種類や通信方式によって異なります。エラー処理やデータの妥当性検証なども追加することで、センサーデータの信頼性を確保する必要があります。また、センサーデータのキャリブレーションやノイズ除去などの処理も必要に応じて実装する必要があります。

* **`image_capture.py`:** このファイルは、カメラから画像を撮影するためのモジュールです。`capture_image` 関数は、OpenCVライブラリを使用して接続されたカメラから画像を取得し、指定されたパスに保存します。カメラの初期化、画像のキャプチャ、ファイルへの保存、エラー処理など、画像撮影に必要な一連の処理が実装されています。将来的には、カメラの設定変更（解像度、明るさなど）や、複数枚の画像撮影、撮影タイミングの制御などの機能を追加することで、より柔軟な画像取得が可能になります。また、Raspberry Piなどの組み込みデバイスでの動作も考慮する必要があります。


### `image_processing/`

* **`image_classifier.py`:** このファイルは、画像認識AIを用いて食品を分類し、その量を推定するためのモジュールです。`classify_image` 関数は、入力された画像パスから画像を読み込み、Hugging Face Transformersの`DetrForObjectDetection` モデルと `DetrImageProcessor` を使用して物体検出を行います。検出された物体のクラスラベルから食品の種類を特定し、将来的には画像から食品の量を推定する機能も追加される予定です。現状では、量推定の代わりにダミーの重量値を返しています。このモジュールは、システムの核となる部分であり、AIモデルの精度がシステム全体の性能に大きく影響します。継続的なモデルの学習と評価、パラメータ調整などを行うことで、認識精度を向上させる必要があります。

### `data_analysis/`

* **`cost_calculator.py`:**  このファイルは、`image_classifier.py`が出力した食品の種類と重量、そして`food_database.py`が提供する食品単価データに基づいて、廃棄された食品のコストを計算する`calculate_cost`関数を定義しています。この関数は、食品の種類に対応する単価を`food_prices.csv`から取得し、重量を乗算することでコストを算出します。単価データが存在しない場合のエラー処理も実装されており、システムの安定性を確保しています。将来的には、単価情報の更新頻度向上や、地域差・季節変動を考慮した動的な価格設定などを検討することで、より正確なコスト計算を実現できる可能性があります。


### `cloud_functions/`

* **`data_api.py`:** このファイルは、クラウド上で動作するAPIを定義しており、主にスマートフォンアプリとのデータのやり取りを担います。Flaskフレームワークを使用して `/upload` と `/data/<user_id>` の2つのエンドポイントを提供します。`/upload` エンドポイントは、アプリから送信された食品廃棄データをデータベースに保存します。`/data/<user_id>` エンドポイントは、指定されたユーザーIDの食品ロスデータを取得し、アプリに返送します。APIの認証、エラー処理、データバリデーションなど、堅牢なAPIに必要な機能を実装することで、システム全体の信頼性を高めています。


### `app/`

* **`app.py`:**  このファイルは、将来開発予定のスマートフォンアプリのプレースホルダーです。 現時点では具体的な機能は実装されておらず、"スマートフォンアプリはまだ開発されていません。" というメッセージを表示するのみです。 将来的には、このファイルにアプリの主要なロジックを実装し、`cloud_functions/data_api.py` と通信してデータの送受信、データの可視化、ユーザーへのフィードバック表示などを行う予定です。  Flutter, React Native などのクロスプラットフォームフレームワーク、または iOS, Android のネイティブ言語で開発されることが想定されます。


### その他のファイル

* **`food_prices.csv`:** このCSVファイルは、食品の単価情報を格納しています。「食品名」と「単価」の2つのカラムで構成され、`database/food_database.py` で読み込まれて使用されます。データの正確性と最新性を維持することが重要です。

* **`main.py`:** このファイルは、システム全体の動作をローカル環境でテストするためのメインプログラムです。センサーデータの読み込み、画像分類、コスト計算、データベースへのデータ保存など、システムの主要な機能を順番に実行します。テストデータやダミーデータを使用して、各モジュールが正しく連携しているかを確認するために使用されます。

* **`requirements.txt`:** このファイルには、`AI-FRCES_Project` を実行するために必要なPythonライブラリが列挙されています。`pip install -r requirements.txt` コマンドを実行することで、すべての必要なライブラリをインストールできます。

* **`requirements-dev.txt`:** このファイルには、`AI-FRCES_Project` の開発時に必要なライブラリが列挙されています。テスト、コードフォーマット、静的解析など、開発を支援するためのライブラリが含まれています。`pip install -r requirements-dev.txt` コマンドを実行することで、開発に必要なライブラリをインストールできます。


これらのファイルとディレクトリ構造は、AI-FRCES_Project の開発と保守を効率的に行うために設計されています。  各モジュールが独立しているため、コードの変更や機能追加が容易に行えます。



## インストール方法

AI-FRCES_Project を実行するためのインストール手順は以下のとおりです。


1. **プロジェクトのクローン:**

   GitHub からプロジェクトをクローンします。以下のコマンドを実行し、`your-username` をご自身のGitHubユーザー名、`AI-FRCES_Project` をリポジトリ名に置き換えてください。

   ```bash
   git clone https://github.com/your-username/AI-FRCES_Project.git
   ```

   または、GitHub のリポジトリページから ZIP ファイルをダウンロードし、解凍することもできます。


2. **仮想環境の作成と有効化:**

   プロジェクトのルートディレクトリ（`AI-FRCES_Project`）に移動し、仮想環境を作成して有効化します。仮想環境を使用することで、プロジェクトに必要なライブラリを他のプロジェクトと分離し、競合を防ぐことができます。

   * **Windows:**

     ```bash
     python -m venv .venv
     .venv\Scripts\activate
     ```

   * **macOS/Linux:**

     ```bash
     python3 -m venv .venv
     source .venv/bin/activate
     ```


3. **必要なライブラリのインストール:**

   `requirements.txt` を使用して、プロジェクトの実行に必要なライブラリをインストールします。

   ```bash
   pip install -r requirements.txt
   ```

   これにより、`transformers`、`torch`、`Pillow`、`timm`、`requests`、`numpy`、`pandas`、`opencv-python`、`Flask`、`SQLAlchemy` がインストールされます。


4. **開発用ライブラリのインストール (任意):**

   開発時に必要なライブラリ（テスト、コードフォーマット、静的解析など）は、`requirements-dev.txt` を使用してインストールします。

   ```bash
   pip install -r requirements-dev.txt
   ```

   これにより、`pytest`、`flake8`、`black`、`isort`、`mypy`、`jupyter`、`requests-mock` がインストールされます。


## 実行方法

ローカル環境でシステムをテスト実行するには、以下の手順に従います。

1. **データベースのセットアップ:** `database/user_data.py` で指定されているデータベースファイル (`user_data.db`) を作成し、`create_table()` 関数を一度だけ実行してテーブルを作成します。 
2. **`food_prices.csv` の配置:**  `food_prices.csv` がプロジェクトのルートディレクトリに存在することを確認します。
3. **テスト画像の配置:** `images` フォルダを作成し、`test_image.jpg` を配置します。
4. **`main.py` の実行:** プロジェクトのルートディレクトリで、以下のコマンドを実行します。

   ```bash
   python main.py
   ```

   これにより、`main.py` が実行され、センサーデータの読み込み（シミュレーション）、画像分類、コスト計算、データベースへのデータ保存が行われます。 実行結果がコンソールに出力されます。

**クラウド関数の実行:**

`cloud_functions/data_api.py` は、クラウド関数としてデプロイして実行する必要があります。 デプロイ手順は、使用するクラウドプラットフォーム (Google Cloud Functions, AWS Lambda, Azure Functions など) によって異なります。


**スマートフォンアプリの実行:**

`app/app.py` は、まだプレースホルダーなので実行できません。  スマートフォンアプリを開発し、クラウド関数と連携させてください。


**補足:**

* 仮想環境を有効化するのを忘れないでください。
* `main.py` はローカルでのテスト用です。 実際の運用では、クラウド関数とスマートフォンアプリが連携して動作します。
* 各モジュールは独立してテストすることもできます。 例えば、`image_classifier.py` の `classify_image` 関数を直接呼び出して、画像分類のテストを行うことができます。



## requirements.txt の補足説明

* **`transformers`:** Hugging Face Transformers。`DetrForObjectDetection`, `DetrImageProcessor` など、自然言語処理・画像処理モデルとツールキットを提供します。
* **`torch`:** PyTorch。深層学習フレームワーク。`transformers` のバックエンドとして使用されます。
* **`Pillow`:** 画像処理ライブラリ。画像の読み込み、操作、保存などに使用します。
* **`timm`:** PyTorch Image Models。`facebook/detr-resnet-50` モデルで使用される `ResNet` バックボーンの効率的な実装を提供します。
* **`requests`:** HTTPライブラリ。HTTPリクエストの送信、レスポンスの処理などに使用します。
* **`numpy`:** 数値計算ライブラリ。多次元配列の処理などに使用します。
* **`pandas`:** データ分析ライブラリ。データの操作、分析などに使用します。`food_prices.csv` の読み込みに使用されます。
* **`opencv-python`:**  OpenCV (Computer Vision) ライブラリ。画像処理、コンピュータビジョンタスクに使用します。`image_capture.py` で使用します。
* **`Flask`:**  軽量なWebフレームワーク。`cloud_functions/data_api.py` でAPIを作成するために使用します。
* **`SQLAlchemy`:**  Python の SQL ツールキットおよびオブジェクトリレーショナルマッパー (ORM)。データベースとのやり取りを簡素化します。 `database/user_data.py` でデータベース操作に利用します。


## requirements-dev.txt の説明

* **`pytest`:** テストフレームワーク。単体テスト、統合テストの作成と実行に使用します。
* **`flake8`:** コードスタイルチェッカー。PEP 8 などのスタイルガイドへの準拠をチェックします。
* **`black`:** コードフォーマッター。コードを自動的にフォーマットし、スタイルを統一します。
* **`isort`:** インポート文ソーター。インポート文を整理し、可読性を向上させます。
* **`mypy`:** 静的型チェッカー。型ヒントに基づいて型チェックを行い、潜在的なエラーを検出します。
* **`jupyter`:** Jupyter Notebook/Lab。インタラクティブなPython環境を提供します。
* **`requests-mock`:** `requests` ライブラリを使ったHTTPリクエストをモックするライブラリ。`cloud_functions/data_api.py` のテストに使用します。


## 今後の展望

AI-FRCES_Projectは、まだ開発の初期段階にあり、多くの機能追加や改善が計画されています。 主要な今後の展望は以下のとおりです。

* **スマートフォンアプリとの連携:** 現状ではクラウド関数とスマートフォンアプリの連携は未実装です。 今後は、**iOS と Android 両方に対応したネイティブアプリを開発**し、ユーザーが食品ロスデータの確認、グラフ表示、パーソナライズされたアドバイスの閲覧などをできるようにする予定です。 アプリでは、データの可視化、パーソナライズされたアドバイスの提供、プッシュ通知によるリマインダー機能など、ユーザーの行動変容を促進するための様々な機能を実装する予定です。

* **複数種類の食品の同時認識:** 現在の`image_classifier.py`では、一度に認識できる食品の種類は一つに限定されています。 今後は、複数の食品が写っている画像からも、それぞれの食品を個別に認識し、種類と量を推定する機能を開発します。これにより、ユーザーは一度に複数の食品を登録することができ、利便性が向上します。この機能の実装には、**より高度な物体検出モデルの採用や、インスタンスセグメンテーションなどの画像分割技術の導入**などが検討されます。

* **より精度の高いAIモデルの開発と学習データセットの拡充:** AIモデルの認識精度は、システム全体の性能を左右する重要な要素です。 今後は、**より大規模で多様なデータセットを構築し、それを用いてモデルを再学習することで、認識精度を向上させる計画**です。また、学習データに偏りがないか、継続的に評価・検証を行い、必要に応じてデータを追加・修正することで、より汎用性の高いモデルを構築します。 さらに、**最新の物体検出モデルや、食品認識に特化したモデルの導入**も検討します。

* **データ分析機能の強化:**  現状では、単純なコスト計算のみ行っていますが、今後はデータ分析機能を強化することで、ユーザーにとってより有益な情報を提供することを目指します。例えば、ユーザーの食品ロス傾向を分析し、**どのような食品がどれくらいの頻度で、どのくらいの量で廃棄されているかを可視化**したり、**ユーザーの食生活に合わせたパーソナライズされた食品保存方法やレシピの提案**などを提供するなどの機能が考えられます。また、地域別、季節別、年齢層別などのデータ分析を行い、食品ロス削減のための効果的な施策立案に役立てることも検討しています。

* **センサー、カメラとの連携:**  現在はセンサーデータの取得と画像撮影はシミュレーションで行っていますが、今後は実際のセンサーとカメラとの連携機能を実装します。これにより、システムの自動化とデータの正確性が向上します。具体的な実装は、使用するセンサーとカメラの種類、通信方式などによって異なります。**Raspberry Pi や Arduino などのデバイスとの連携も検討**し、ハードウェアを含めたシステム全体の統合を進めます。

* **体積・重量推定機能の実装:** `image_classifier.py` における体積・重量推定機能の実装は、大きな課題です。画像から正確に食品の体積や重量を推定するためには、高度な画像処理技術や機械学習モデルの開発が必要になります。**３Dカメラの導入や、深度推定アルゴリズムの開発、あるいは既製のモデルの活用**なども検討します。


## ライセンス

LICENSE ファイルを参照してください。


## 免責事項

このプロジェクトは、家庭における食品ロスとそのコストを算出することを目的とした研究開発プロジェクトであり、実用的な製品またはサービスとして提供されているわけではありません。センサーやカメラとの連携、スマートフォンアプリとの連携、体積・重量推定などの機能は、まだ開発段階にあり、完全な動作を保証するものではありません。**また、本システムは開発段階にあり、安定性やセキュリティは保証されていません。**

本プロジェクトで使用されているAIモデルは、特定のデータセットで学習されているため、すべての食品を正しく認識できるわけではありません。認識精度には限界があり、誤認識が発生する可能性があります。また、`food_prices.csv` に記載されている食品の単価はサンプルデータであり、実際の市場価格とは異なる場合があります。これらのデータの正確性については保証できません。

本プロジェクトのコードおよびデータは、教育および研究目的での利用を想定しており、商用利用は**明示的に禁止**します。本プロジェクトを利用した結果生じた損害について、開発者は一切の責任を負いません。自己責任でご利用ください。

本プロジェクトは、yf591 によって開発・提供されています。

